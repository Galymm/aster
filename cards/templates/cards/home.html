{% extends 'cards/base.html' %}
{% block content %}

<h2 class="mb-4 text-center">ASTER CARDS</h2>

<!-- –ü–æ–∏—Å–∫ -->
<form method="get" class="row g-3 mb-4 align-items-center justify-content-center">
  <div class="col-md-6">
    <input type="text" name="q" class="form-control" placeholder="–ü–æ–∏—Å–∫..." value="{{ request.GET.q }}">
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">–ù–∞–π—Ç–∏</button>
  </div>
</form>

<!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div class="mb-4">
  <h5 class="fw-bold">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h5>
  {% for category in categories %}
    <div class="mb-3">
      <a href="?category={{ category.name }}" class="btn btn-outline-primary btn-sm {% if selected_category == category.name %}active{% endif %}">
        {{ category.name }}
      </a>

      {% if user.is_authenticated %}
        {% if user_is_editor or user.is_superuser %}
          <a href="{% url 'edit_category' category.id %}" class="btn btn-outline-success btn-sm ms-2">‚úèÔ∏è</a>
          <a href="{% url 'delete_category' category.id %}" class="btn btn-outline-danger btn-sm ms-1">‚ùå</a>
          <a href="{% url 'add_subcategory' category.id %}" class="btn btn-outline-secondary btn-sm ms-1">‚ûï –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</a>
        {% endif %}
      {% endif %}

      {% for sub in category.subcategories.all %}
        <div class="ms-4 mt-2">
          <a href="?subcategory={{ sub.name }}" class="btn btn-outline-secondary btn-sm {% if selected_subcategory == sub.name %}active{% endif %}">
            ‚Ü≥ {{ sub.name }}
          </a>
          {% if can_edit %}
            <a href="{% url 'edit_category' category.id %}" class="btn btn-outline-success btn-sm ms-2">‚úèÔ∏è</a>
            <a href="{% url 'delete_category' category.id %}" class="btn btn-outline-danger btn-sm ms-1">‚ùå</a>
            <a href="{% url 'add_subcategory' category.id %}" class="btn btn-outline-secondary btn-sm ms-1">‚ûï –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</a>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% empty %}
    <p class="text-muted">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç üòï</p>
  {% endfor %}
</div>

<hr>

<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
{% if cards %}
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for card in cards %}
    <div class="col">
      <div class="flip-card" onclick="this.classList.toggle('flipped')">
        <div class="flip-card-inner shadow-sm border-0">
          <div class="flip-card-front card bg-white p-3 d-flex flex-column justify-content-between">
            <div>
              <h5 class="card-title">{{ card.question }}</h5>
              <p class="text-muted small">{{ card.category.name }}</p>
            </div>
            <div class="text-center mt-3">
              <p class="text-primary fw-semibold">–£–∑–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç</p>
            </div>
          </div>
          <div class="flip-card-back card bg-primary text-white p-3 d-flex flex-column justify-content-between">
            <div>
              <h5 class="card-title">{{ card.answer }}</h5>
            </div>
            <div class="text-center mt-3">
              <p class="text-light">–í–µ—Ä–Ω—É—Ç—å—Å—è</p>
            </div>
          </div>
        </div>
      </div>

      {% if can_edit %}
      <div class="text-center mt-2">
        <a href="{% url 'edit_card' card.id %}" class="btn btn-sm bg-success text-white">‚úèÔ∏è</a>
        <a href="{% url 'delete_card' card.id %}" class="btn btn-sm bg-danger text-white">‚ùå</a>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center text-muted py-5">
    <p>–ù–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ üòï</p>
    {% if can_edit %}
      <a href="{% url 'add_card' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É</a>
    {% endif %}
  </div>
{% endif %}

{% endblock %}
